=====================
Переходы и Навигация
=====================

Одной из главных фич ``maxo.dialogs`` является использование стека диалогов и маршрутизация.

Управление DialogManager
========================

Для управления диалогами из хэндлеров и кнопок используется ``DialogManager``. Он доступен как аргумент в колбеках или инжектится в обычные хэндлеры через DI.

Основные методы:

- ``start(state, data, mode)``: Открыть новый диалог. Новое состояние добавляется поверх текущего стека диалогов.
- ``switch_to(state)``: Переключить окно в рамках *текущего* диалога.
- ``next()`` / ``back()``: Следующее или предыдущее окно (по порядку их объявления в ``Dialog``).
- ``done(result)``: Закрыть текущий диалог и вернуться к предыдущему (если был запущен поверх). Можно вернуть результат.
- ``update(data)``: Обновить данные текущего контекста и перерисовать сообщение.

Режимы запуска (StartMode)
==========================

При запуске диалога можно указать режим (``mode``):

.. code-block:: python

    from maxo.dialogs import StartMode

    # Обычный запуск (поверх текущего)
    await manager.start(SG.main, mode=StartMode.NORMAL)

    # Очистить стек перед запуском (закрыть все предыдущие)
    await manager.start(SG.main, mode=StartMode.RESET_STACK)

Стек диалогов
=============

Вы можете запускать диалог из другого диалога. При вызове ``start()`` новый диалог оказывается на вершине стека и берет управление на себя. Когда он вызовет ``done(result)``, он закроется, и управление вернется к предыдущему диалогу, который получит этот ``result`` через обработчик ``on_process_result`` (определяемый в ``Dialog()``).
